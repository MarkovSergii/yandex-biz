function savecoordinats(){var t=[MarkCoords[0].toFixed(4),MarkCoords[1].toFixed(4)],e=[(MarkCoords[0]-deltaX).toFixed(4),(MarkCoords[1]-deltaY).toFixed(4)],a=[(MarkCoords[0]-deltaX).toFixed(4),(MarkCoords[1]+deltaY).toFixed(4)],r=[(MarkCoords[0]+deltaX).toFixed(4),(MarkCoords[1]-deltaY).toFixed(4)],o=[(MarkCoords[0]+deltaX).toFixed(4),(MarkCoords[1]+deltaY).toFixed(4)];myPlacemark.getOverlay().getData().geometry.setCoordinates(t),myPlacemark_buttom_left.getOverlay().getData().geometry.setCoordinates(e),myPlacemark_buttom_right.getOverlay().getData().geometry.setCoordinates(a),myPlacemark_top_left.getOverlay().getData().geometry.setCoordinates(r),myPlacemark_top_right.getOverlay().getData().geometry.setCoordinates(o),$("#lat").text(t[0]),$("#long").text(t[1])}var deltaX=.05,deltaY=.05,zone=.05,startX=50.450846,startY=30.405572,myMap,MarkCoords,myPlacemark,myPlacemark_buttom_left,myPlacemark_buttom_right,myPlacemark_top_left,myPlacemark_top_right;MarkCoords=[startX,startY],$(document).ready(function(){function t(){myMap=new ymaps.Map("YMapsID",{center:[startX,startY],zoom:11}),myMap.controls.add("zoomControl"),myPlacemark=new ymaps.Placemark([startX,startY],{},{preset:"twirl#redIcon",draggable:!0}),myPlacemark_buttom_left=new ymaps.Placemark([startX-deltaX,startX-deltaY],{},{preset:"twirl#blueIcon",draggable:!1}),myPlacemark_buttom_right=new ymaps.Placemark([startX-deltaX,startY+deltaY],{},{preset:"twirl#blueIcon",draggable:!1}),myPlacemark_top_left=new ymaps.Placemark([startX+deltaX,startX-deltaY],{},{preset:"twirl#blueIcon",draggable:!1}),myPlacemark_top_right=new ymaps.Placemark([startX+deltaX,startY+deltaY],{},{preset:"twirl#blueIcon",draggable:!1}),myMap.geoObjects.add(myPlacemark),myMap.geoObjects.add(myPlacemark_buttom_left),myMap.geoObjects.add(myPlacemark_buttom_right),myMap.geoObjects.add(myPlacemark_top_left),myMap.geoObjects.add(myPlacemark_top_right),savecoordinats(),myPlacemark.events.add("dragend",function(t){MarkCoords=this.geometry.getCoordinates(),savecoordinats()},myPlacemark),myMap.events.add("click",function(t){MarkCoords=t.get("coordPosition"),savecoordinats()}),myMap.events.add("boundschange",function(t){t.get("newZoom")!=t.get("oldZoom")&&savecoordinats(),t.get("newCenter")!=t.get("oldCenter")&&savecoordinats()})}ymaps.ready(t)});var result_mas=[],result_count=result_mas.length,CSV=function(t){var e=Object.keys(t[0]),a=e.join(";")+"\n";return t.forEach(function(t){e.forEach(function(e,r){r&&(a+=";"),a+=t[e]}),a+="\n"}),a},check_for_dubles=function(t){for(var e=[],a=0;a<t.length;a++){for(var r=0;r<result_mas.length;r++){var o=!1;if(result_mas[r].id==t[a].id){o=!0;break}}o||e.push(t[a])}return e},structure_date=function(t){if(t){var e="";return Array.isArray(t)?t.forEach(function(t,a,r){e=t.formatted?e+t.formatted+",":t.href?e+t.href+",":e+t.name+","}):e="object"==typeof t?t.name:t,e}return""},getCorrectData=function(t){var e=[];return t.features.forEach(function(t){var a={};a.id=t.properties.CompanyMetaData.id,a.name=t.properties.CompanyMetaData.name,a.address=t.properties.CompanyMetaData.address,a.url=structure_date(t.properties.CompanyMetaData.url),a.Categories=structure_date(t.properties.CompanyMetaData.Categories),a.Phones=structure_date(t.properties.CompanyMetaData.Phones),a.Links=structure_date(t.properties.CompanyMetaData.Links),a.postalCode=structure_date(t.properties.CompanyMetaData.postalCode),a.email=structure_date(t.properties.CompanyMetaData.email),a.emails=structure_date(t.properties.CompanyMetaData.emails),e.push(a)}),e},ckeck_cookie_api=function(){return api=$.cookie("api_key")};$(document).ready(function(){alert("heelo"),function(){ckeck_cookie_api()&&$("#api_key").val(ckeck_cookie_api()),$("#obl").mask("0.00"),$("#obl").val(zone)}(),$("#btn_get_data").click(function(){var t=$("#lat").text(),e=$("#long").text(),a=$("#obl").val(),r=$("#search_text").val(),o=$("#api_key").val();if(""!=r&&""!=o){if($("#save_api").prop("checked")){var s=ckeck_cookie_api();s?s!=o&&$.cookie("api_key",o):$.cookie("api_key",o)}$.get("https://search-maps.yandex.ru/v1/?text="+encodeURIComponent(r)+"&ll="+e+","+t+"&spn="+a+","+a+"&type=biz&results=500&rspn=1&lang=ru_RU&apikey="+o,function(t){if(t.status)"error"==t.status&&swal("Error!","Ошибка или лимит","error");else{var e=getCorrectData(t);result_mas=result_mas.concat(check_for_dubles(e)),result_count=result_mas.length,swal("Успех","Найдено "+e.length+" компаний"),$("#result_count").text(result_count)}}).fail(function(){swal("Error!","Ошибка","error")})}else swal("Error!","Нужно ввести поисковую фразу и API ключ","error")}),$("#set_obl_btn").click(function(){zone=$("#obl").val(),deltaX=Number(zone),deltaY=Number(zone),savecoordinats()}),$("#save_all").click(function(){_.isEmpty(result_mas)?swal("Внимание!","Масив с данными пустой","warning"):swal({title:"Сохранение!",text:"Введите имя файла для сохранения:",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"Имя файла"},function(t){if(t===!1)return!1;if(""===t)return swal.showInputError("Необходимо ввести имя!"),!1;var e=new Blob([CSV(result_mas)],{type:"text/plain;charset=utf-8"});saveAs(e,t+".csv"),swal("Отлично!","Успешно сохранено","success")})}),$("#show_all").click(function(){if(_.isEmpty(result_mas))swal("Внимание!","Масив с данными пустой","warning");else{var t=window.open("newpage.html","_blank");$.get("table.html",function(e){var a=_.template(e);t.document.write(a({company:result_mas})),t.document.close()})}}),$("#delete_all").click(function(){swal({title:"Вы уверены?",text:"Все данные будут удалены",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Да, удалить!",cancelButtonText:"Отмена",closeOnConfirm:!1},function(){result_mas=[],result_count=result_mas.length,$("#result_count").text(result_count),swal({title:"Удалено!",text:"Можете приступать к новой добыче :).",type:"success",timer:1e3})})})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInlhbmQuanMiLCJDT05TVC5qcyIsIm1haW4uanMiXSwibmFtZXMiOlsic2F2ZWNvb3JkaW5hdHMiLCJuZXdfY29vcmRzIiwiTWFya0Nvb3JkcyIsInRvRml4ZWQiLCJuZXdfY29vcmRzX2J1dHRvbV9sZWZ0IiwiZGVsdGFYIiwiZGVsdGFZIiwibmV3X2Nvb3Jkc19idXR0b21fcmlnaHQiLCJuZXdfY29vcmRzX3RvcF9sZWZ0IiwibmV3X2Nvb3Jkc190b3BfcmlnaHQiLCJteVBsYWNlbWFyayIsImdldE92ZXJsYXkiLCJnZXREYXRhIiwiZ2VvbWV0cnkiLCJzZXRDb29yZGluYXRlcyIsIm15UGxhY2VtYXJrX2J1dHRvbV9sZWZ0IiwibXlQbGFjZW1hcmtfYnV0dG9tX3JpZ2h0IiwibXlQbGFjZW1hcmtfdG9wX2xlZnQiLCJteVBsYWNlbWFya190b3BfcmlnaHQiLCIkIiwidGV4dCIsInpvbmUiLCJzdGFydFgiLCJzdGFydFkiLCJteU1hcCIsImRvY3VtZW50IiwicmVhZHkiLCJpbml0IiwieW1hcHMiLCJNYXAiLCJjZW50ZXIiLCJ6b29tIiwiY29udHJvbHMiLCJhZGQiLCJQbGFjZW1hcmsiLCJwcmVzZXQiLCJkcmFnZ2FibGUiLCJnZW9PYmplY3RzIiwiZXZlbnRzIiwiZSIsInRoaXMiLCJnZXRDb29yZGluYXRlcyIsImdldCIsImV2ZW50IiwicmVzdWx0X21hcyIsInJlc3VsdF9jb3VudCIsImxlbmd0aCIsIkNTViIsImFycmF5Iiwia2V5cyIsIk9iamVjdCIsInJlc3VsdCIsImpvaW4iLCJmb3JFYWNoIiwib2JqIiwiayIsIml4IiwiY2hlY2tfZm9yX2R1YmxlcyIsImluY29taW5nX21hcyIsIm5ld19tYXMiLCJpIiwiaiIsImZvdW5kIiwiaWQiLCJwdXNoIiwic3RydWN0dXJlX2RhdGUiLCJzb21lIiwicmVzIiwiQXJyYXkiLCJpc0FycmF5IiwiaXRlbSIsImFyciIsImZvcm1hdHRlZCIsImhyZWYiLCJuYW1lIiwiZ2V0Q29ycmVjdERhdGEiLCJib2R5IiwibWFzIiwiZmVhdHVyZXMiLCJvbmVfY29tcGFueSIsInByb3BlcnRpZXMiLCJDb21wYW55TWV0YURhdGEiLCJhZGRyZXNzIiwidXJsIiwiQ2F0ZWdvcmllcyIsIlBob25lcyIsIkxpbmtzIiwicG9zdGFsQ29kZSIsImVtYWlsIiwiZW1haWxzIiwiY2tlY2tfY29va2llX2FwaSIsImFwaSIsImNvb2tpZSIsImFsZXJ0IiwidmFsIiwibWFzayIsImNsaWNrIiwibGF0IiwibG9uZyIsIm9ibCIsImlucHV0X3RleHQiLCJBUElfS0VZIiwicHJvcCIsInNhdmVkX2FwaSIsImVuY29kZVVSSUNvbXBvbmVudCIsImRhdGEiLCJzdGF0dXMiLCJzd2FsIiwic29tZV9kYXRhIiwiY29uY2F0IiwiZmFpbCIsIk51bWJlciIsIl8iLCJpc0VtcHR5IiwidGl0bGUiLCJ0eXBlIiwic2hvd0NhbmNlbEJ1dHRvbiIsImNsb3NlT25Db25maXJtIiwiYW5pbWF0aW9uIiwiaW5wdXRQbGFjZWhvbGRlciIsImlucHV0VmFsdWUiLCJzaG93SW5wdXRFcnJvciIsImJsb2IiLCJCbG9iIiwic2F2ZUFzIiwibnciLCJ3aW5kb3ciLCJvcGVuIiwiY29tcGlsZWQiLCJ0ZW1wbGF0ZSIsIndyaXRlIiwiY29tcGFueSIsImNsb3NlIiwiY29uZmlybUJ1dHRvbkNvbG9yIiwiY29uZmlybUJ1dHRvblRleHQiLCJjYW5jZWxCdXR0b25UZXh0IiwidGltZXIiXSwibWFwcGluZ3MiOiJBQVNBLFFBQUFBLGtCQUNBLEdBQUFDLElBQUFDLFdBQUEsR0FBQUMsUUFBQSxHQUFBRCxXQUFBLEdBQUFDLFFBQUEsSUFFQUMsSUFBQUYsV0FBQSxHQUFBRyxRQUFBRixRQUFBLElBQUFELFdBQUEsR0FBQUksUUFBQUgsUUFBQSxJQUNBSSxJQUFBTCxXQUFBLEdBQUFHLFFBQUFGLFFBQUEsSUFBQUQsV0FBQSxHQUFBSSxRQUFBSCxRQUFBLElBQ0FLLElBQUFOLFdBQUEsR0FBQUcsUUFBQUYsUUFBQSxJQUFBRCxXQUFBLEdBQUFJLFFBQUFILFFBQUEsSUFD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LEtBQUEsb0NBQ0ErRixLQUFBLFFBQ0FDLGtCQUFBLEVBQ0FDLGdCQUFBLEVBQ0FDLFVBQUEsaUJBQ0FDLGlCQUFBLGFBQ0EsU0FBQUMsR0FDQSxHQUFBQSxLQUFBLEVBQUEsT0FBQSxDQUNBLElBQUEsS0FBQUEsRUFFQSxNQURBYixNQUFBYyxlQUFBLDJCQUNBLENBRUEsSUFBQUMsR0FBQSxHQUFBQyxPQUFBNUUsSUFBQUgsY0FBQXVFLEtBQUEsNEJBQ0FTLFFBQUFGLEVBQUFGLEVBQUEsUUFDQWIsS0FBQSxXQUFBLG9CQUFBLGVBU0F4RixFQUFBLGFBQUE2RSxNQUFBLFdBR0EsR0FBQWdCLEVBQUFDLFFBQUFyRSxZQUVBK0QsS0FBQSxZQUFBLHlCQUFBLGVBRUEsQ0FDQSxHQUFBa0IsR0FBQUMsT0FBQUMsS0FBQSxlQUFBLFNBRUE1RyxHQUFBdUIsSUFBQSxhQUFBLFNBQUErRCxHQUNBLEdBQUF1QixHQUFBaEIsRUFBQWlCLFNBQUF4QixFQUNBb0IsR0FBQXBHLFNBQUF5RyxNQUFBRixHQUFBRyxRQUFBdkYsY0FDQWlGLEVBQUFwRyxTQUFBMkcsYUFPQWpILEVBQUEsZUFBQTZFLE1BQUEsV0FDQVcsTUFDQU8sTUFBQSxjQUNBOUYsS0FBQSwyQkFDQStGLEtBQUEsVUFDQUMsa0JBQUEsRUFDQWlCLG1CQUFBLFVBQ0FDLGtCQUFBLGVBQ0FDLGlCQUFBLFNBQ0FsQixnQkFBQSxHQUNBLFdBRUF6RSxjQUNBQyxhQUFBRCxXQUFBRSxPQUNBM0IsRUFBQSxpQkFBQUMsS0FBQXlCLGNBQ0E4RCxNQUNBTyxNQUFBLFdBQ0E5RixLQUFBLHVDQUNBK0YsS0FBQSxVQUNBcUIsTUFBQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWFya29mZiBvbiAxMy4wNS4yMDE2LlxyXG4gKi9cclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIG15TWFwLCAgTWFya0Nvb3JkcztcclxudmFyIG15UGxhY2VtYXJrLG15UGxhY2VtYXJrX2J1dHRvbV9sZWZ0LG15UGxhY2VtYXJrX2J1dHRvbV9yaWdodCxteVBsYWNlbWFya190b3BfbGVmdCxteVBsYWNlbWFya190b3BfcmlnaHQ7XHJcbk1hcmtDb29yZHMgPSBbc3RhcnRYLCBzdGFydFldO1xyXG5cclxuZnVuY3Rpb24gc2F2ZWNvb3JkaW5hdHMgKCl7XHJcbiAgICB2YXIgbmV3X2Nvb3JkcyA9IFtNYXJrQ29vcmRzWzBdLnRvRml4ZWQoNCksIE1hcmtDb29yZHNbMV0udG9GaXhlZCg0KV07XHJcblxyXG4gICAgdmFyIG5ld19jb29yZHNfYnV0dG9tX2xlZnQgPSAgWyhNYXJrQ29vcmRzWzBdLWRlbHRhWCkudG9GaXhlZCg0KSwgKE1hcmtDb29yZHNbMV0tZGVsdGFZKS50b0ZpeGVkKDQpXTtcclxuICAgIHZhciBuZXdfY29vcmRzX2J1dHRvbV9yaWdodCA9IFsoTWFya0Nvb3Jkc1swXS1kZWx0YVgpLnRvRml4ZWQoNCksIChNYXJrQ29vcmRzWzFdK2RlbHRhWSkudG9GaXhlZCg0KV07XHJcbiAgICB2YXIgbmV3X2Nvb3Jkc190b3BfbGVmdCA9ICAgICBbKE1hcmtDb29yZHNbMF0rZGVsdGFYKS50b0ZpeGVkKDQpLCAoTWFya0Nvb3Jkc1sxXS1kZWx0YVkpLnRvRml4ZWQoNCldO1xyXG4gICAgdmFyIG5ld19jb29yZHNfdG9wX3JpZ2h0ID0gICAgWyhNYXJrQ29vcmRzWzBdK2RlbHRhWCkudG9GaXhlZCg0KSwgKE1hcmtDb29yZHNbMV0rZGVsdGFZKS50b0ZpeGVkKDQpXTtcclxuXHJcblxyXG4gICAgbXlQbGFjZW1hcmsuZ2V0T3ZlcmxheSgpLmdldERhdGEoKS5nZW9tZXRyeS5zZXRDb29yZGluYXRlcyhuZXdfY29vcmRzKTtcclxuICAgIG15UGxhY2VtYXJrX2J1dHRvbV9sZWZ0LmdldE92ZXJsYXkoKS5nZXREYXRhKCkuZ2VvbWV0cnkuc2V0Q29vcmRpbmF0ZXMobmV3X2Nvb3Jkc19idXR0b21fbGVmdCk7XHJcbiAgICBteVBsYWNlbWFya19idXR0b21fcmlnaHQuZ2V0T3ZlcmxheSgpLmdldERhdGEoKS5nZW9tZXRyeS5zZXRDb29yZGluYXRlcyhuZXdfY29vcmRzX2J1dHRvbV9yaWdodCk7XHJcbiAgICBteVBsYWNlbWFya190b3BfbGVmdC5nZXRPdmVybGF5KCkuZ2V0RGF0YSgpLmdlb21ldHJ5LnNldENvb3JkaW5hdGVzKG5ld19jb29yZHNfdG9wX2xlZnQpO1xyXG4gICAgbXlQbGFjZW1hcmtfdG9wX3JpZ2h0LmdldE92ZXJsYXkoKS5nZXREYXRhKCkuZ2VvbWV0cnkuc2V0Q29vcmRpbmF0ZXMobmV3X2Nvb3Jkc190b3BfcmlnaHQpO1xyXG5cclxuXHJcblxyXG4gICAgJChcIiNsYXRcIikudGV4dChuZXdfY29vcmRzWzBdKTtcclxuICAgICQoXCIjbG9uZ1wiKS50ZXh0KG5ld19jb29yZHNbMV0pO1xyXG5cclxufVxyXG5cclxuXHJcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcblxyXG5cclxuXHJcblxyXG4gICAgeW1hcHMucmVhZHkoaW5pdCk7XHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdCAoKSB7XHJcblxyXG4gICAgICAgIC8v0J7Qv9GA0LXQtNC10LvRj9C10Lwg0L3QsNGH0LDQu9GM0L3Ri9C1INC/0LDRgNCw0LzQtdGC0YDRiyDQutCw0YDRgtGLXHJcbiAgICAgICAgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKCdZTWFwc0lEJywge1xyXG4gICAgICAgICAgICBjZW50ZXI6IFtzdGFydFgsIHN0YXJ0WV0sXHJcbiAgICAgICAgICAgIHpvb206IDExXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8v0JTQvtCx0LDQstC70Y/QtdC8INGN0LvQtdC80LXQvdGC0Ysg0YPQv9GA0LDQstC70LXQvdC40Y8g0L3QsCDQutCw0YDRgtGDXHJcbiAgICAgICAgbXlNYXAuY29udHJvbHNcclxuICAgICAgICAgICAgLmFkZCgnem9vbUNvbnRyb2wnKTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgLy/QntC/0YDQtdC00LXQu9GP0LXQvCDQvNC10YLQutGDINC4INC00L7QsdCw0LLQu9GP0LXQvCDQtdC1INC90LAg0LrQsNGA0YLRg1xyXG4gICAgICAgIG15UGxhY2VtYXJrID0gbmV3IHltYXBzLlBsYWNlbWFyayhbc3RhcnRYLCBzdGFydFldLHt9LCB7cHJlc2V0OiBcInR3aXJsI3JlZEljb25cIiwgZHJhZ2dhYmxlOiB0cnVlfSk7XHJcbiAgICAgICAgbXlQbGFjZW1hcmtfYnV0dG9tX2xlZnQgPSBuZXcgeW1hcHMuUGxhY2VtYXJrKFtzdGFydFgtZGVsdGFYLCBzdGFydFgtZGVsdGFZXSx7fSwge3ByZXNldDogXCJ0d2lybCNibHVlSWNvblwiLCBkcmFnZ2FibGU6IGZhbHNlfSk7XHJcbiAgICAgICAgbXlQbGFjZW1hcmtfYnV0dG9tX3JpZ2h0ID0gbmV3IHltYXBzLlBsYWNlbWFyayhbc3RhcnRYLWRlbHRhWCwgc3RhcnRZK2RlbHRhWV0se30sIHtwcmVzZXQ6IFwidHdpcmwjYmx1ZUljb25cIiwgZHJhZ2dhYmxlOiBmYWxzZX0pO1xyXG4gICAgICAgIG15UGxhY2VtYXJrX3RvcF9sZWZ0ID0gbmV3IHltYXBzLlBsYWNlbWFyayhbc3RhcnRYK2RlbHRhWCwgc3RhcnRYLWRlbHRhWV0se30sIHtwcmVzZXQ6IFwidHdpcmwjYmx1ZUljb25cIiwgZHJhZ2dhYmxlOiBmYWxzZX0pO1xyXG4gICAgICAgIG15UGxhY2VtYXJrX3RvcF9yaWdodCA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoW3N0YXJ0WCtkZWx0YVgsIHN0YXJ0WStkZWx0YVldLHt9LCB7cHJlc2V0OiBcInR3aXJsI2JsdWVJY29uXCIsIGRyYWdnYWJsZTogZmFsc2V9KTtcclxuXHJcblxyXG4gICAgICAgIG15TWFwLmdlb09iamVjdHMuYWRkKG15UGxhY2VtYXJrKTtcclxuICAgICAgICBteU1hcC5nZW9PYmplY3RzLmFkZChteVBsYWNlbWFya19idXR0b21fbGVmdCk7XHJcbiAgICAgICAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlQbGFjZW1hcmtfYnV0dG9tX3JpZ2h0KTtcclxuICAgICAgICBteU1hcC5nZW9PYmplY3RzLmFkZChteVBsYWNlbWFya190b3BfbGVmdCk7XHJcbiAgICAgICAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlQbGFjZW1hcmtfdG9wX3JpZ2h0KTtcclxuXHJcblxyXG4gICAgICAgIHNhdmVjb29yZGluYXRzKCk7XHJcblxyXG5cclxuICAgICAgICAvL9Ce0YLRgdC70LXQttC40LLQsNC10Lwg0YHQvtCx0YvRgtC40LUg0L/QtdGA0LXQvNC10YnQtdC90LjRjyDQvNC10YLQutC4XHJcbiAgICAgICAgbXlQbGFjZW1hcmsuZXZlbnRzLmFkZChcImRyYWdlbmRcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgTWFya0Nvb3JkcyA9IHRoaXMuZ2VvbWV0cnkuZ2V0Q29vcmRpbmF0ZXMoKTtcclxuICAgICAgICAgICAgc2F2ZWNvb3JkaW5hdHMoKTtcclxuICAgICAgICB9LCBteVBsYWNlbWFyayk7XHJcblxyXG4gICAgICAgIC8v0J7RgtGB0LvQtdC20LjQstCw0LXQvCDRgdC+0LHRi9GC0LjQtSDRidC10LvRh9C60LAg0L/QviDQutCw0YDRgtC1XHJcbiAgICAgICAgbXlNYXAuZXZlbnRzLmFkZCgnY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBNYXJrQ29vcmRzID0gZS5nZXQoJ2Nvb3JkUG9zaXRpb24nKTtcclxuICAgICAgICAgICAgc2F2ZWNvb3JkaW5hdHMoKTtcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIC8v0J7RgdC70LXQttC40LLQsNC10Lwg0YHQvtCx0YvRgtC40LUg0LjQt9C80LXQvdC10L3QuNGPINC+0LHQu9Cw0YHRgtC4INC/0YDQvtGB0LzQvtGC0YDQsCDQutCw0YDRgtGLIC0g0LzQsNGB0YjRgtCw0LEg0Lgg0YbQtdC90YLRgCDQutCw0YDRgtGLXHJcbiAgICAgICAgbXlNYXAuZXZlbnRzLmFkZCgnYm91bmRzY2hhbmdlJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChldmVudC5nZXQoJ25ld1pvb20nKSAhPSBldmVudC5nZXQoJ29sZFpvb20nKSkge1xyXG4gICAgICAgICAgICAgICAgc2F2ZWNvb3JkaW5hdHMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZXZlbnQuZ2V0KCduZXdDZW50ZXInKSAhPSBldmVudC5nZXQoJ29sZENlbnRlcicpKSB7XHJcbiAgICAgICAgICAgICAgICBzYXZlY29vcmRpbmF0cygpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvL9Ck0YPQvdC60YbQuNGPINC00LvRjyDQv9C10YDQtdC00LDRh9C4INC/0L7Qu9GD0YfQtdC90L3Ri9GFINC30L3QsNGH0LXQvdC40Lkg0LIg0YTQvtGA0LzRg1xyXG5cclxuXHJcblxyXG59KTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBNYXJrb2ZmIG9uIDEzLjA1LjIwMTYuXHJcbiAqL1xyXG52YXIgZGVsdGFYID0gMC4wNTtcclxudmFyIGRlbHRhWSA9IDAuMDU7XHJcbnZhciB6b25lID0gMC4wNTtcclxuXHJcbnZhciBzdGFydFggPSA1MC40NTA4NDY7XHJcbnZhciBzdGFydFkgPSAgMzAuNDA1NTcyOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1hcmtvZmYgb24gMTIuMDUuMjAxNi5cclxuICovXHJcblxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG52YXIgcmVzdWx0X21hcyA9IFtdO1xyXG52YXIgcmVzdWx0X2NvdW50ID0gcmVzdWx0X21hcy5sZW5ndGg7XHJcblxyXG52YXIgQ1NWID0gZnVuY3Rpb24gKGFycmF5KSB7XHJcbiAgICAvLyBVc2UgZmlyc3QgZWxlbWVudCB0byBjaG9vc2UgdGhlIGtleXMgYW5kIHRoZSBvcmRlclxyXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhhcnJheVswXSk7XHJcblxyXG4gICAgLy8gQnVpbGQgaGVhZGVyXHJcbiAgICB2YXIgcmVzdWx0ID0ga2V5cy5qb2luKFwiO1wiKSArIFwiXFxuXCI7XHJcblxyXG4gICAgLy8gQWRkIHRoZSByb3dzXHJcbiAgICBhcnJheS5mb3JFYWNoKGZ1bmN0aW9uKG9iail7XHJcbiAgICAgICAga2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGssIGl4KXtcclxuICAgICAgICAgICAgaWYgKGl4KSByZXN1bHQgKz0gXCI7XCI7XHJcbiAgICAgICAgICAgIHJlc3VsdCArPSBvYmpba107XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmVzdWx0ICs9IFwiXFxuXCI7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59O1xyXG5cclxudmFyIGNoZWNrX2Zvcl9kdWJsZXMgPSBmdW5jdGlvbihpbmNvbWluZ19tYXMpXHJcbntcclxuICAgIHZhciBuZXdfbWFzID1bXTtcclxuICAgIGZvciAodmFyIGk9IDAgOyBpPGluY29taW5nX21hcy5sZW5ndGg7aSsrKVxyXG4gICAge1xyXG5cclxuICAgICAgICBmb3IgKHZhciBqPTA7ajxyZXN1bHRfbWFzLmxlbmd0aDtqKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdF9tYXNbal0uaWQgPT0gaW5jb21pbmdfbWFzW2ldLmlkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWZvdW5kKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbmV3X21hcy5wdXNoKGluY29taW5nX21hc1tpXSlcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBuZXdfbWFzO1xyXG59O1xyXG5cclxuXHJcbnZhciBzdHJ1Y3R1cmVfZGF0ZSA9IGZ1bmN0aW9uKHNvbWUpXHJcbntcclxuXHJcbiAgICBpZiAoc29tZSlcclxuICAgIHtcclxuICAgICAgICB2YXIgcmVzID0gXCJcIjtcclxuICAgICAgICB2YXIgcmVzX3RlbCA9IFwiXCI7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc29tZSkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzb21lLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaSwgYXJyKXtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmZvcm1hdHRlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXMgPSByZXMgKyBpdGVtLmZvcm1hdHRlZCsnLCc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaHJlZilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IHJlcyArIGl0ZW0uaHJlZisnLCc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IHJlcyArIGl0ZW0ubmFtZSsnLCc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHNvbWUgPT09ICdvYmplY3QnKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXMgPSBzb21lLm5hbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgIHJlcyA9IHNvbWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXM7XHJcbiAgICB9XHJcbiAgICBlbHNlXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICB9XHJcblxyXG5cclxufTtcclxuXHJcbnZhciBnZXRDb3JyZWN0RGF0YSA9IGZ1bmN0aW9uKGJvZHkpXHJcbntcclxuICAgIHZhciBtYXMgPVtdO1xyXG5cclxuICAgIGJvZHkuZmVhdHVyZXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcclxuICAgICAgICB2YXIgb25lX2NvbXBhbnkgPSB7fTtcclxuXHJcbiAgICAgICAgb25lX2NvbXBhbnkuaWQgPSBpdGVtLnByb3BlcnRpZXMuQ29tcGFueU1ldGFEYXRhLmlkO1xyXG4gICAgICAgIG9uZV9jb21wYW55Lm5hbWUgPSBpdGVtLnByb3BlcnRpZXMuQ29tcGFueU1ldGFEYXRhLm5hbWU7XHJcbiAgICAgICAgb25lX2NvbXBhbnkuYWRkcmVzcyA9IGl0ZW0ucHJvcGVydGllcy5Db21wYW55TWV0YURhdGEuYWRkcmVzcztcclxuICAgICAgICBvbmVfY29tcGFueS51cmwgPSBzdHJ1Y3R1cmVfZGF0ZShpdGVtLnByb3BlcnRpZXMuQ29tcGFueU1ldGFEYXRhLnVybCk7XHJcbiAgICAgICAgb25lX2NvbXBhbnkuQ2F0ZWdvcmllcyA9IHN0cnVjdHVyZV9kYXRlKGl0ZW0ucHJvcGVydGllcy5Db21wYW55TWV0YURhdGEuQ2F0ZWdvcmllcyk7XHJcbiAgICAgICAgb25lX2NvbXBhbnkuUGhvbmVzID0gc3RydWN0dXJlX2RhdGUoaXRlbS5wcm9wZXJ0aWVzLkNvbXBhbnlNZXRhRGF0YS5QaG9uZXMpO1xyXG4gICAgICAgIG9uZV9jb21wYW55LkxpbmtzID0gc3RydWN0dXJlX2RhdGUoaXRlbS5wcm9wZXJ0aWVzLkNvbXBhbnlNZXRhRGF0YS5MaW5rcyk7XHJcbiAgICAgICAgb25lX2NvbXBhbnkucG9zdGFsQ29kZSA9IHN0cnVjdHVyZV9kYXRlKGl0ZW0ucHJvcGVydGllcy5Db21wYW55TWV0YURhdGEucG9zdGFsQ29kZSk7XHJcbiAgICAgICAgb25lX2NvbXBhbnkuZW1haWwgPSBzdHJ1Y3R1cmVfZGF0ZShpdGVtLnByb3BlcnRpZXMuQ29tcGFueU1ldGFEYXRhLmVtYWlsKTtcclxuICAgICAgICBvbmVfY29tcGFueS5lbWFpbHMgPSBzdHJ1Y3R1cmVfZGF0ZShpdGVtLnByb3BlcnRpZXMuQ29tcGFueU1ldGFEYXRhLmVtYWlscyk7XHJcblxyXG5cclxuICAgICAgICBtYXMucHVzaChvbmVfY29tcGFueSk7XHJcblxyXG5cclxuICAgIH0pO1xyXG5cclxuXHJcblxyXG4gICAgcmV0dXJuIG1hc1xyXG59O1xyXG5cclxuXHJcbnZhciBja2Vja19jb29raWVfYXBpID0gZnVuY3Rpb24oKVxyXG57XHJcbiAgIHJldHVybiBhcGkgPSAgJC5jb29raWUoJ2FwaV9rZXknKTtcclxuXHJcbn07XHJcblxyXG5cclxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcclxuXHJcbmFsZXJ0KCdoZWVsbycpO1xyXG4gICAoZnVuY3Rpb24oKXtcclxuICAgICAgIC8vINC/0YDQvtCy0LXRgNC40YLRjCDQvdCw0LvQuNGH0LjQtSDQutC70Y7Rh9CwINCyINC60YPQutC4XHJcbiAgICAgICAvLyDQtdGB0LvQuCDQtdGB0YLRjCDRgtC+INC/0L7RgdGC0LDQstC40YLRjCDQtdCz0L5cclxuICAgICAgICBpZiAoY2tlY2tfY29va2llX2FwaSgpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgJCgnI2FwaV9rZXknKS52YWwoY2tlY2tfY29va2llX2FwaSgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgJCgnI29ibCcpLm1hc2soJzAuMDAnKTtcclxuICAgICAgICAkKCcjb2JsJykudmFsKHpvbmUpO1xyXG4gICAgfSkoKTtcclxuXHJcbiAgICAkKCcjYnRuX2dldF9kYXRhJykuY2xpY2soZnVuY3Rpb24oKXtcclxuXHJcblxyXG4gICAgICAgIHZhciBsYXQgPSAkKFwiI2xhdFwiKS50ZXh0KCk7XHJcbiAgICAgICAgdmFyIGxvbmcgPSAgJChcIiNsb25nXCIpLnRleHQoKTtcclxuICAgICAgICB2YXIgb2JsID0gJCgnI29ibCcpLnZhbCgpO1xyXG4gICAgICAgIHZhciBpbnB1dF90ZXh0ID0gJCgnI3NlYXJjaF90ZXh0JykudmFsKCk7XHJcbiAgICAgICAgdmFyIEFQSV9LRVkgPSAkKCcjYXBpX2tleScpLnZhbCgpO1xyXG4gICAgICAgIGlmIChpbnB1dF90ZXh0IT0nJyAmJiBBUElfS0VZIT0nJylcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8g0L/RgNC+0LLQtdGA0LjRgtGMINCz0LDQu9C+0YfQutGDINC/0YDQviDRgdC+0YXRgNCw0L3QtdC90LjQtSDQutC70Y7Rh9CwXHJcbiAgICAgICAgICAgICAgICAvLyDQv9GA0L7QstC10YDQuNGC0Ywg0L3QsNC70LjRh9C40LUg0LrQu9GO0YfQsFxyXG4gICAgICAgICAgICAgICAgLy8g0LXRgdC70Lgg0L3QtdGCINGC0L4g0LfQsNC/0LjRgdCw0YLRjFxyXG4gICAgICAgICAgICAgICAgaWYgKCQoJyNzYXZlX2FwaScpLnByb3AoJ2NoZWNrZWQnKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZWRfYXBpID0gY2tlY2tfY29va2llX2FwaSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzYXZlZF9hcGkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZWRfYXBpICE9IEFQSV9LRVkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuY29va2llKCdhcGlfa2V5JyxBUElfS0VZKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmNvb2tpZSgnYXBpX2tleScsQVBJX0tFWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAkLmdldCgnaHR0cHM6Ly9zZWFyY2gtbWFwcy55YW5kZXgucnUvdjEvP3RleHQ9JyArIGVuY29kZVVSSUNvbXBvbmVudChpbnB1dF90ZXh0KSArICcmbGw9JyArIGxvbmcgKyAnLCcgKyBsYXQgKyAnJnNwbj0nICsgb2JsICsgJywnICsgb2JsICsgJyZ0eXBlPWJpeiZyZXN1bHRzPTUwMCZyc3BuPTEmbGFuZz1ydV9SVSZhcGlrZXk9JyArIEFQSV9LRVksIGZ1bmN0aW9uIChkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzPT1cImVycm9yXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3YWwoXCJFcnJvciFcIiwgXCLQntGI0LjQsdC60LAg0LjQu9C4INC70LjQvNC40YJcIiwgXCJlcnJvclwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNvbWVfZGF0YSA9IGdldENvcnJlY3REYXRhKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdF9tYXMgPSByZXN1bHRfbWFzLmNvbmNhdChjaGVja19mb3JfZHVibGVzKHNvbWVfZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0X2NvdW50ID0gcmVzdWx0X21hcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2FsKFwi0KPRgdC/0LXRhVwiLCBcItCd0LDQudC00LXQvdC+IFwiICsgc29tZV9kYXRhLmxlbmd0aCArIFwiINC60L7QvNC/0LDQvdC40LlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjcmVzdWx0X2NvdW50JykudGV4dChyZXN1bHRfY291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZmFpbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3YWwoXCJFcnJvciFcIiwgXCLQntGI0LjQsdC60LBcIiwgXCJlcnJvclwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc3dhbChcIkVycm9yIVwiLCBcItCd0YPQttC90L4g0LLQstC10YHRgtC4INC/0L7QuNGB0LrQvtCy0YPRjiDRhNGA0LDQt9GDINC4IEFQSSDQutC70Y7Rh1wiLCBcImVycm9yXCIpXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuICAgICQoJyNzZXRfb2JsX2J0bicpLmNsaWNrKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgIHpvbmUgPSAkKCcjb2JsJykudmFsKCk7XHJcbiAgICAgICAgZGVsdGFYID0gTnVtYmVyKHpvbmUpO1xyXG4gICAgICAgIGRlbHRhWSA9IE51bWJlcih6b25lKTtcclxuICAgICAgICBzYXZlY29vcmRpbmF0cygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJCgnI3NhdmVfYWxsJykuY2xpY2soZnVuY3Rpb24oKXtcclxuXHJcbiAgaWYgKF8uaXNFbXB0eShyZXN1bHRfbWFzKSlcclxuICB7XHJcbiAgICAgIHN3YWwoXCLQktC90LjQvNCw0L3QuNC1IVwiLCBcItCc0LDRgdC40LIg0YEg0LTQsNC90L3Ri9C80Lgg0L/Rg9GB0YLQvtC5XCIsIFwid2FybmluZ1wiKTtcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICAgICAgICBzd2FsKHtcclxuICAgICAgICAgICAgICB0aXRsZTogXCLQodC+0YXRgNCw0L3QtdC90LjQtSFcIixcclxuICAgICAgICAgICAgICB0ZXh0OiBcItCS0LLQtdC00LjRgtC1INC40LzRjyDRhNCw0LnQu9CwINC00LvRjyDRgdC+0YXRgNCw0L3QtdC90LjRjzpcIixcclxuICAgICAgICAgICAgICB0eXBlOiBcImlucHV0XCIsXHJcbiAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICBjbG9zZU9uQ29uZmlybTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgYW5pbWF0aW9uOiBcInNsaWRlLWZyb20tdG9wXCIsXHJcbiAgICAgICAgICAgICAgaW5wdXRQbGFjZWhvbGRlcjogXCLQmNC80Y8g0YTQsNC50LvQsFwiXHJcbiAgICAgICAgICB9LCBmdW5jdGlvbiAoaW5wdXRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgIGlmIChpbnB1dFZhbHVlID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgIGlmIChpbnB1dFZhbHVlID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgIHN3YWwuc2hvd0lucHV0RXJyb3IoXCLQndC10L7QsdGF0L7QtNC40LzQviDQstCy0LXRgdGC0Lgg0LjQvNGPIVwiKTtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW0NTVihyZXN1bHRfbWFzKV0sIHt0eXBlOiBcInRleHQvcGxhaW47Y2hhcnNldD11dGYtOFwifSk7XHJcbiAgICAgICAgICAgICAgc2F2ZUFzKGJsb2IsIGlucHV0VmFsdWUgKyBcIi5jc3ZcIik7XHJcbiAgICAgICAgICAgICAgc3dhbChcItCe0YLQu9C40YfQvdC+IVwiLCBcItCj0YHQv9C10YjQvdC+INGB0L7RhdGA0LDQvdC10L3QvlwiLCBcInN1Y2Nlc3NcIik7XHJcblxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcblxyXG5cclxuICAgIH0pO1xyXG5cclxuICAgICQoJyNzaG93X2FsbCcpLmNsaWNrKGZ1bmN0aW9uKCl7XHJcblxyXG5cclxuICAgICAgICBpZiAoXy5pc0VtcHR5KHJlc3VsdF9tYXMpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc3dhbChcItCS0L3QuNC80LDQvdC40LUhXCIsIFwi0JzQsNGB0LjQsiDRgSDQtNCw0L3QvdGL0LzQuCDQv9GD0YHRgtC+0LlcIiwgXCJ3YXJuaW5nXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICB2YXIgbncgPSB3aW5kb3cub3BlbignbmV3cGFnZS5odG1sJywgJ19ibGFuaycpO1xyXG5cclxuICAgICAgICAgICAgJC5nZXQoJ3RhYmxlLmh0bWwnLGZ1bmN0aW9uKGRhdGEpe1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbXBpbGVkID0gXy50ZW1wbGF0ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgIG53LmRvY3VtZW50LndyaXRlKGNvbXBpbGVkKHtjb21wYW55OnJlc3VsdF9tYXN9KSk7XHJcbiAgICAgICAgICAgICAgICBudy5kb2N1bWVudC5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH0pO1xyXG5cclxuICAgICQoJyNkZWxldGVfYWxsJykuY2xpY2soZnVuY3Rpb24oKXtcclxuICAgICAgICBzd2FsKHtcclxuICAgICAgICAgICAgdGl0bGU6IFwi0JLRiyDRg9Cy0LXRgNC10L3Riz9cIixcclxuICAgICAgICAgICAgdGV4dDogXCLQktGB0LUg0LTQsNC90L3Ri9C1INCx0YPQtNGD0YIg0YPQtNCw0LvQtdC90YtcIixcclxuICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXHJcbiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXHJcbiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogXCIjREQ2QjU1XCIsXHJcbiAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcItCU0LAsINGD0LTQsNC70LjRgtGMIVwiLFxyXG4gICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcItCe0YLQvNC10L3QsFwiLFxyXG4gICAgICAgICAgICBjbG9zZU9uQ29uZmlybTogZmFsc2VcclxuICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICByZXN1bHRfbWFzID0gW107XHJcbiAgICAgICAgICAgIHJlc3VsdF9jb3VudCA9IHJlc3VsdF9tYXMubGVuZ3RoO1xyXG4gICAgICAgICAgICAkKCcjcmVzdWx0X2NvdW50JykudGV4dChyZXN1bHRfY291bnQpO1xyXG4gICAgICAgICAgICBzd2FsKHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOlwi0KPQtNCw0LvQtdC90L4hXCIsXHJcbiAgICAgICAgICAgICAgICB0ZXh0Olwi0JzQvtC20LXRgtC1INC/0YDQuNGB0YLRg9C/0LDRgtGMINC6INC90L7QstC+0Lkg0LTQvtCx0YvRh9C1IDopLlwiLFxyXG4gICAgICAgICAgICAgICAgdHlwZTpcInN1Y2Nlc3NcIixcclxuICAgICAgICAgICAgICAgIHRpbWVyOiAxMDAwXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG59KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
